ARCH=@ARCH@

CFLAGS +=-D_LINUX -fPIC
ifeq ($(ARCH), osx)
	CFLAGS +=-D__linux__
endif

OBJS=Depacker.o digidrum.o XBMCYM.o Ym2149Ex.o Ymload.o YmMusic.o YmUserInterface.o LZH/LZHXLIB.o

LIB=../../../../../system/players/paplayer/stsoundlibrary-@ARCH@.so

include ../../../../../Makefile.include

lib: $(LIB)

$(LIB): $(OBJS)
ifeq ($(ARCH), osx)
	ld -bundle -flat_namespace -undefined suppress -o $@ $(OBJS)
	../../../../../tools/Mach5/wrapper.rb $@;mv output.so $@
	chmod +x $@

else
	gcc -fPIC -shared -o $@ $(OBJS) `cat ../../../DllLoader/exports/wrapper.def` ../../../DllLoader/exports/wrapper.o

endif