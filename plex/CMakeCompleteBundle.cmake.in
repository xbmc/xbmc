set(PLEXDIR @PLEXDIR@)
set(ROOTDIR @ROOTDIR@)
set(DEPENDDIR @DEPENDDIR@)
set(RESOURCEPATH @RESOURCEPATH@)
set(BINPATH @BINPATH@)
set(LIBPATH @LIBPATH@)
set(ARCH @ARCH@)

if(APPLE)
  set(TARGET "Plex.app")
elseif(UNIX)
  set(TARGET "${BINPATH}/Plex")
endif()

function(gp_item_default_embedded_path_override item default_embedded_path_var)
  set(path "@executable_path")
  if(APPLE)
    set(path "@executable_path/../Frameworks")
  else()
    set(path "@executable_path")
  endif()
  set(${default_embedded_path_var} ${path} PARENT_SCOPE)
endfunction()

if(APPLE)
  include(${PLEXDIR}/BundleUtilitiesPlex.cmake)
else()
  include(BundleUtilities)
endif()

set(BU_CHMOD_BUNDLE_ITEMS ON)
file(GLOB INST_LIBS ${CMAKE_INSTALL_PREFIX}/${LIBPATH}/*${CMAKE_SHARED_LIBRARY_SUFFIX})
set(plugins ${CMAKE_INSTALL_PREFIX}/${RESOURCEPATH}/XBMC/system/ImageLib-${ARCH}.so)
fixup_bundle(${CMAKE_INSTALL_PREFIX}/${TARGET} "${plugins};${INST_LIBS}" "${DEPENDDIR}/lib;${DEPENDDIR}/Frameworks;${DEPENDDIR}/lib64")

if(APPLE)
  message("Signing binary: ${CMAKE_INSTALL_PREFIX}/Plex.app")
  execute_process(COMMAND codesign --force --sign "Developer ID Application: Plex Inc." -r ${PLEXDIR}/Resources/requirement.bin ${CMAKE_INSTALL_PREFIX}/Plex.app)
endif()
